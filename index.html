<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>StudyStar</title>
<link rel="icon" type="image/png" href="images/star.png">
<style>
  body {
    font-family: 'Arial', sans-serif;
    margin: 0; padding: 0;
    background-color: #f0f8ff;
    color: #1a1a1a;
  }
  header {
    background-color: #0077b6;
    color: white;
    padding: 20px;
    text-align: center;
  }
  h1 { margin: 0; }
  main { padding: 20px; max-width: 800px; margin: auto; }
  button {
    background-color: #ffb703;
    border: none; border-radius: 5px;
    padding: 8px 15px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover { background-color: #faa307; }
  #login-container, #study-container, #progress-container { display: none; }
  .category-btn { margin: 5px; }
  #chat {
    border: 1px solid #0077b6;
    padding: 10px; border-radius: 10px;
    max-height: 250px; overflow-y: auto;
    background-color: #e0f7ff;
  }
  .message { margin: 5px 0; padding: 8px 12px; border-radius: 12px; }
  .star-msg { background-color: #ffb703; }
  .user-msg { background-color: #90e0ef; text-align: right; }
  input[type=text] { padding: 8px; width: 70%; margin-right: 5px; border-radius: 5px; border: 1px solid #0077b6; }
</style>
</head>
<body>

<header>
  <h1>StudyStar üåü</h1>
  <p>Your AI Study Buddy for Coding, Math & Science</p>
</header>

<main>
  <!-- LOGIN -->
  <div id="login-container">
    <h2>Login or Signup</h2>
    <input type="text" id="username" placeholder="Enter your name">
    <button id="login-btn">Start Studying</button>
  </div>

  <!-- CATEGORY SELECTION -->
  <div id="category-container">
    <h2>Welcome, <span id="user-display"></span>! Choose a category:</h2>
    <button class="category-btn" data-category="Coding">Coding</button>
    <button class="category-btn" data-category="Math">Math</button>
    <button class="category-btn" data-category="Science">Science</button>
  </div>

  <!-- STUDY CHAT -->
  <div id="study-container">
    <h2>Category: <span id="current-category"></span></h2>
    <div id="chat"></div>
    <input type="text" id="user-input" placeholder="Type your answer...">
    <button id="send-btn">Send</button>
    <p>Stars earned: <span id="stars-count">0</span> ‚≠ê</p>
    <button id="back-btn">Back to Categories</button>
  </div>

  <!-- PROGRESS -->
  <div id="progress-container">
    <h2>Progress for <span id="progress-user"></span></h2>
    <p>Total Stars: <span id="total-stars">0</span> ‚≠ê</p>
    <button id="home-btn">Back to Home</button>
  </div>
</main>

<script>
  // =======================
  // INITIALIZATION
  // =======================
  const loginContainer = document.getElementById('login-container');
  const categoryContainer = document.getElementById('category-container');
  const studyContainer = document.getElementById('study-container');
  const progressContainer = document.getElementById('progress-container');
  const chatDiv = document.getElementById('chat');
  const userDisplay = document.getElementById('user-display');
  const currentCategory = document.getElementById('current-category');
  const starsCount = document.getElementById('stars-count');

  let username = localStorage.getItem('studystar-user') || '';
  let stars = JSON.parse(localStorage.getItem('studystar-stars')) || {};
  let currentCat = '';

  function showLogin() {
    loginContainer.style.display = 'block';
    categoryContainer.style.display = 'none';
    studyContainer.style.display = 'none';
    progressContainer.style.display = 'none';
  }

  function showCategories() {
    loginContainer.style.display = 'none';
    categoryContainer.style.display = 'block';
    studyContainer.style.display = 'none';
    progressContainer.style.display = 'none';
  }

  function showStudy() {
    loginContainer.style.display = 'none';
    categoryContainer.style.display = 'none';
    studyContainer.style.display = 'block';
    progressContainer.style.display = 'none';
    chatDiv.innerHTML = `<div class="message star-msg">üåü Hello ${username}! Let's start learning ${currentCat}!</div>`;
  }

  // =======================
  // LOGIN
  // =======================
  document.getElementById('login-btn').addEventListener('click', () => {
    const input = document.getElementById('username').value.trim();
    if(input) {
      username = input;
      localStorage.setItem('studystar-user', username);
      userDisplay.textContent = username;
      showCategories();
    }
  });

  // =======================
  // CATEGORY SELECTION
  // =======================
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      currentCat = btn.dataset.category;
      currentCategory.textContent = currentCat;
      if(!stars[username]) stars[username] = {};
      if(!stars[username][currentCat]) stars[username][currentCat] = 0;
      starsCount.textContent = stars[username][currentCat];
      showStudy();
    });
  });

  // =======================
  // AI / STAR LOGIC
  // =======================
  async function askStar(question) {
    // ------------------------
    // PLACE YOUR OPENAI API KEY HERE
    // ------------------------
    const OPENAI_KEY = "YOUR_API_KEY_HERE"; // Replace with your StudyStar key
    
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method: "POST",
      headers: {
        "Content-Type":"application/json",
        "Authorization":`Bearer ${OPENAI_KEY}`
      },
      body: JSON.stringify({
        model:"gpt-4",
        messages:[
          {role:"system", content:"You are Star, a friendly AI tutor. Teach the student interactively in the chosen category. Adjust difficulty, give hints if wrong, and explain clearly."},
          {role:"user", content: question}
        ],
        max_tokens: 300
      })
    });
    const data = await response.json();
    return data.choices[0].message.content;
  }

  function appendMessage(msg, className) {
    const div = document.createElement('div');
    div.className = `message ${className}`;
    div.innerText = msg;
    chatDiv.appendChild(div);
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }

  document.getElementById('send-btn').addEventListener('click', async () => {
    const input = document.getElementById('user-input');
    const text = input.value.trim();
    if(!text) return;
    appendMessage(text, 'user-msg');
    input.value = '';
    
    const reply = await askStar(text);
    appendMessage(reply, 'star-msg');

    // Reward logic: basic example
    if(reply.toLowerCase().includes("correct") || reply.toLowerCase().includes("well done")) {
      stars[username][currentCat]++;
      starsCount.textContent = stars[username][currentCat];
      localStorage.setItem('studystar-stars', JSON.stringify(stars));
    }
  });

  // Enter key
  document.getElementById('user-input').addEventListener('keypress', (e) => {
    if(e.key === 'Enter') document.getElementById('send-btn').click();
  });

  // =======================
  // BACK BUTTON
  // =======================
  document.getElementById('back-btn').addEventListener('click', showCategories);

  // =======================
  // INITIAL DISPLAY
  // =======================
  if(username) {
    userDisplay.textContent = username;
    showCategories();
  } else showLogin();

</script>

</body>
</html>
